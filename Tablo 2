CREATE TABLE ARACLAR (
    ARAC_ID NUMBER DEFAULT ARACLAR_SEQ.NEXTVAL NOT NULL,
    VIN VARCHAR2(17) NOT NULL UNIQUE, -- Şasi Numarası
    MARKA_ID NUMBER NOT NULL,
    MODEL_ID NUMBER NOT NULL,
    URETIM_YILI NUMBER(4) NOT NULL,
    KASA_TIPI VARCHAR2(50),
    MOTOR_HACMI_CC NUMBER,
    BEYGIR_GUCU NUMBER,
    TORK NUMBER(10,2),
    VITES_TIPI VARCHAR2(20),
    YAKIT_TIPI VARCHAR2(20),
    RENK VARCHAR2(50),
    SATIS_FIYAT NUMBER(18, 2) NOT NULL, -- Peşin/Başlangıç Fiyatı
    SUBE_ID NUMBER NOT NULL,
    DURUM VARCHAR2(50) DEFAULT 'Stokta' NOT NULL, -- 'Stokta', 'Rezerve', 'Satıldı', 'Test Sürüşünde'
    CONSTRAINT PK_ARACLAR PRIMARY KEY (ARAC_ID)
)
PARTITION BY LIST (SUBE_ID) (
    PARTITION P_SUBE1 VALUES (1) TABLESPACE SUBE1_ENVANTER_TS,
    PARTITION P_SUBE2 VALUES (2) TABLESPACE SUBE2_ENVANTER_TS,
    PARTITION P_SUBE3 VALUES (3) TABLESPACE SUBE3_ENVANTER_TS
)
TABLESPACE GALERI_DATA_TS;

CREATE TABLE RANDEVULAR (
    RANDEVU_ID NUMBER DEFAULT RANDEVULAR_SEQ.NEXTVAL NOT NULL,
    MUSTERI_ID NUMBER NOT NULL,
    ARAC_ID NUMBER, -- Test sürüşü için opsiyonel
    CALISAN_ID NUMBER NOT NULL,
    RANDEVU_TARIH_SAAT TIMESTAMP NOT NULL,
    RANDEVU_TIPI VARCHAR2(50) NOT NULL, -- 'Test Sürüşü', 'Görüşme', 'Finansman Danışmanlığı'
    DURUM VARCHAR2(50) DEFAULT 'Planlandi' NOT NULL, -- 'Planlandi', 'Tamamlandi', 'İptal Edildi'
    SUBE_ID NUMBER NOT NULL,
    CONSTRAINT PK_RANDEVULAR PRIMARY KEY (RANDEVU_ID)
)
PARTITION BY RANGE (RANDEVU_TARIH_SAAT) (CREATE TABLE SATISLAR (
    SATIS_ID NUMBER DEFAULT SATISLAR_SEQ.NEXTVAL NOT NULL,
    ARAC_ID NUMBER UNIQUE NOT NULL, -- Bir araç sadece bir kez satılır, bu FK aynı zamanda UNIQUE’tir
    MUSTERI_ID NUMBER NOT NULL,
    CALISAN_ID NUMBER NOT NULL,
    SUBE_ID NUMBER NOT NULL,
    SATIS_TARIHI DATE DEFAULT SYSDATE NOT NULL,
    NIHAI_SATIS_FIYAT NUMBER(18, 2) NOT NULL,
    ODEME_YONTEMI VARCHAR2(50) NOT NULL, -- 'Nakit', 'Kredi Kartı', 'Banka Havalesi', 'Taksitli'
    TAKSIT_SAYISI NUMBER, -- NULL olabilir eğer peşin satışsa
    AYLIK_TAKSIT_TUTARI NUMBER(18, 2), -- NULL olabilir
    GARANTI_SURESI_YIL NUMBER(2),
    GARANTI_BITIS_TARIHI DATE NOT NULL,
    CONSTRAINT PK_SATISLAR PRIMARY KEY (SATIS_ID)
)
PARTITION BY RANGE (SATIS_TARIHI) (
    PARTITION P_SATIS_ONCE_2024 VALUES LESS THAN (TO_DATE('2024-01-01', 'YYYY-MM-DD')) TABLESPACE SATIS_ARSIV_TS,
    PARTITION P_SATIS_2024_Q1 VALUES LESS THAN (TO_DATE('2024-04-01', 'YYYY-MM-DD')) TABLESPACE GALERI_DATA_TS,
    PARTITION P_SATIS_2024_Q2 VALUES LESS THAN (TO_DATE('2024-07-01', 'YYYY-MM-DD')) TABLESPACE GALERI_DATA_TS,
    PARTITION P_SATIS_2024_Q3 VALUES LESS THAN (TO_DATE('2024-10-01', 'YYYY-MM-DD')) TABLESPACE GALERI_DATA_TS,
    PARTITION P_SATIS_2024_Q4 VALUES LESS THAN (TO_DATE('2025-01-01', 'YYYY-MM-DD')) TABLESPACE GALERI_DATA_TS,
    PARTITION P_SATIS_2025_Q1 VALUES LESS THAN (TO_DATE('2025-04-01', 'YYYY-MM-DD')) TABLESPACE GALERI_DATA_TS,
    PARTITION P_SATIS_GELECEK VALUES LESS THAN (MAXVALUE) TABLESPACE GALERI_DATA_TS
);

    PARTITION P_ONCE_2024 VALUES LESS THAN (TIMESTAMP '2024-01-01 00:00:00') TABLESPACE SATIS_ARSIV_TS,
    PARTITION P_2024_Q1 VALUES LESS THAN (TIMESTAMP '2024-04-01 00:00:00') TABLESPACE GALERI_DATA_TS,CREATE TABLE TAKSIT_ODEMELERI (
    TAKSIT_ID NUMBER DEFAULT TAKSIT_ODEMELERI_SEQ.NEXTVAL NOT NULL,
    SATIS_ID NUMBER NOT NULL,
    TAKSIT_SIRA_NO NUMBER NOT NULL,
    ODENMESI_GEREKEN_TARIH DATE NOT NULL,
    ODENEN_TUTAR NUMBER(18, 2), -- NULL olabilir
    ODEME_TARIHI DATE, -- NULL olabilir
    DURUM VARCHAR2(50) DEFAULT 'Odenmedi' NOT NULL, -- 'Odendi', 'Odenmedi', 'Gecikmeli'
    CONSTRAINT PK_TAKSIT_ODEMELERI PRIMARY KEY (TAKSIT_ID),
    CONSTRAINT FK_TAKSIT_SATIS FOREIGN KEY (SATIS_ID) REFERENCES SATISLAR(SATIS_ID),
    CONSTRAINT UNQ_TAKSIT_SIRA UNIQUE (SATIS_ID, TAKSIT_SIRA_NO)
)
TABLESPACE GALERI_DATA_TS;


    PARTITION P_2024_Q2 VALUES LESS THAN (TIMESTAMP '2024-07-01 00:00:00') TABLESPACE GALERI_DATA_TS,
    PARTITION P_2024_Q3 VALUES LESS THAN (TIMESTAMP '2024-10-01 00:00:00') TABLESPACE GALERI_DATA_TS,
    PARTITION P_2024_Q4 VALUES LESS THAN (TIMESTAMP '2025-01-01 00:00:00') TABLESPACE GALERI_DATA_TS,
    PARTITION P_2025_Q1 VALUES LESS THAN (TIMESTAMP '2025-04-01 00:00:00') TABLESPACE GALERI_DATA_TS,
    PARTITION P_2025_Q2 VALUES LESS THAN (TIMESTAMP '2025-07-01 00:00:00') TABLESPACE GALERI_DATA_TS,
    PARTITION P_GELECEK VALUES LESS THAN (MAXVALUE) TABLESPACE GALERI_DATA_TS
);

ALTER TABLE ARACLAR ADD CONSTRAINT FK_ARAC_MARKA 
FOREIGN KEY (MARKA_ID) REFERENCES MARKA_TANIMLARI(MARKA_ID);

ALTER TABLE ARACLAR ADD CONSTRAINT FK_ARAC_MODEL 
FOREIGN KEY (MODEL_ID) REFERENCES MODEL_TANIMLARI(MODEL_ID);

ALTER TABLE ARACLAR ADD CONSTRAINT FK_ARAC_SUBE 
FOREIGN KEY (SUBE_ID) REFERENCES SUBELER(SUBE_ID);

ALTER TABLE POTANSIYEL_MUSTERILER ADD CONSTRAINT FK_LEAD_ARAC_AFTER_ARAC 
FOREIGN KEY (ILGI_DUYULAN_ARAC_ID) REFERENCES ARACLAR(ARAC_ID);

ALTER TABLE RANDEVULAR ADD CONSTRAINT FK_RANDEVU_MUSTERI 
FOREIGN KEY (MUSTERI_ID) REFERENCES MUSTERILER(MUSTERI_ID);

ALTER TABLE RANDEVULAR ADD CONSTRAINT FK_RANDEVU_ARAC 
FOREIGN KEY (ARAC_ID) REFERENCES ARACLAR(ARAC_ID);

ALTER TABLE RANDEVULAR ADD CONSTRAINT FK_RANDEVU_CALISAN 
FOREIGN KEY (CALISAN_ID) REFERENCES CALISANLAR(CALISAN_ID);

ALTER TABLE RANDEVULAR ADD CONSTRAINT FK_RANDEVU_SUBE 
FOREIGN KEY (SUBE_ID) REFERENCES SUBELER(SUBE_ID);

ALTER TABLE SATISLAR ADD CONSTRAINT FK_SATIS_ARAC 
FOREIGN KEY (ARAC_ID) REFERENCES ARACLAR(ARAC_ID);

ALTER TABLE SATISLAR ADD CONSTRAINT FK_SATIS_MUSTERI 
FOREIGN KEY (MUSTERI_ID) REFERENCES MUSTERILER(MUSTERI_ID);

ALTER TABLE SATISLAR ADD CONSTRAINT FK_SATIS_CALISAN 
FOREIGN KEY (CALISAN_ID) REFERENCES CALISANLAR(CALISAN_ID);

ALTER TABLE SATISLAR ADD CONSTRAINT FK_SATIS_SUBE 
FOREIGN KEY (SUBE_ID) REFERENCES SUBELER(SUBE_ID);

ALTER TABLE FATURALAR ADD CONSTRAINT FK_FATURA_SATIS 
FOREIGN KEY (SATIS_ID) REFERENCES SATISLAR(SATIS_ID);

